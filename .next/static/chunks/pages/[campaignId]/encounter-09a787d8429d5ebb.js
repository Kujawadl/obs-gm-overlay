(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[813],{9334:function(e,n,r){"use strict";var i=r(3366),o=r(7462),s=r(7294),t=r(3680),a=r(4780),l=r(5861),c=r(9773),d=r(1657),u=r(948),x=r(6336),p=r(5893);let m=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],h=e=>{let{classes:n,inset:r,primary:i,secondary:o,dense:s}=e;return(0,a.Z)({root:["root",r&&"inset",s&&"dense",i&&o&&"multiline"],primary:["primary"],secondary:["secondary"]},x.L,n)},v=(0,u.ZP)("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,n)=>{let{ownerState:r}=e;return[{[`& .${x.Z.primary}`]:n.primary},{[`& .${x.Z.secondary}`]:n.secondary},n.root,r.inset&&n.inset,r.primary&&r.secondary&&n.multiline,r.dense&&n.dense]}})(({ownerState:e})=>(0,o.Z)({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},e.primary&&e.secondary&&{marginTop:6,marginBottom:6},e.inset&&{paddingLeft:56})),j=s.forwardRef(function(e,n){let r=(0,d.Z)({props:e,name:"MuiListItemText"}),{children:a,className:u,disableTypography:x=!1,inset:j=!1,primary:Z,primaryTypographyProps:y,secondary:f,secondaryTypographyProps:g}=r,b=(0,i.Z)(r,m),{dense:E}=s.useContext(c.Z),C=null!=Z?Z:a,w=f,N=(0,o.Z)({},r,{disableTypography:x,inset:j,primary:!!C,secondary:!!w,dense:E}),k=h(N);return null==C||C.type===l.Z||x||(C=(0,p.jsx)(l.Z,(0,o.Z)({variant:E?"body2":"body1",className:k.primary,component:null!=y&&y.variant?void 0:"span",display:"block"},y,{children:C}))),null==w||w.type===l.Z||x||(w=(0,p.jsx)(l.Z,(0,o.Z)({variant:"body2",className:k.secondary,color:"text.secondary",display:"block"},g,{children:w}))),(0,p.jsxs)(v,(0,o.Z)({className:(0,t.Z)(k.root,u),ownerState:N,ref:n},b,{children:[C,w]}))});n.Z=j},3315:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[campaignId]/encounter",function(){return r(80)}])},80:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return B}});var i=r(5893),o=r(2428),s=r(6574),t=r(5861),a=r(9226),l=r(3321),c=r(9008),d=r.n(c),u=r(1163),x=r(7294),p=r(8169),m=(0,p.Z)((0,i.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),h=r(8054),v=r(8462),j=r(891),Z=r(9334),y=r(1797),f=(0,p.Z)((0,i.jsx)("path",{d:"M8 5v14l11-7z"}),"PlayArrow"),g=r(6761),b=r(2734),E=r(8396),C=r(657),w=r(7645),N=r(6580),k=r(8951),T=r(1425),I=r(1664),M=r.n(I);function P(e){let{campaign:n,encounter:r,refetch:o}=e,s=(0,u.useRouter)(),[c]=(0,h.DM)({variables:{campaignId:n.id,encounterId:null==r?void 0:r.id}}),[d]=(0,h.Co)({variables:{campaignId:n.id,encounterId:r.id},refetchQueries:[h.N8]}),[p,m]=(0,x.useState)(!1),v=(0,b.Z)(),I=(0,E.Z)(v.breakpoints.only("xs")),P=(0,x.useCallback)(()=>{d().then(e=>{var r,i;let{data:o}=e;(null==o?void 0:null===(r=o.campaign)||void 0===r?void 0:null===(i=r.encounter)||void 0===i?void 0:i.setActive)&&s.push("/".concat(n.id,"/encounter/run"))})},[d,s,n.id]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(j.ZP,{sx:{flexWrap:"wrap",border:0,borderBottom:1,borderStyle:"solid",borderColor:"grey.400"},children:[(0,i.jsx)(Z.Z,{sx:{flexBasis:"100%"},children:(0,i.jsxs)(a.Z,{display:"flex",justifyContent:"space-between",width:"100%",children:[(0,i.jsx)(t.Z,{variant:"h5",component:"span",children:r.name}),r.round>0?(0,i.jsxs)(t.Z,{variant:"h6",color:"text.secondary",component:"span",children:["(Round ",r.round,")"]}):null]})}),(0,i.jsxs)(a.Z,{sx:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",width:"100%"},children:[(0,i.jsx)(a.Z,{sx:{flexGrow:1,flexBasis:I?"100%":"auto"},children:(0,i.jsx)(M(),{href:"/".concat(n.id,"/encounter/").concat(r.id,"/edit"),children:(0,i.jsxs)(l.Z,{component:"a",children:[(0,i.jsx)(y.Z,{sx:{paddingRight:1,fontSize:"1.8rem"}}),"Edit"]})})}),(0,i.jsx)(a.Z,{sx:{flexGrow:1,flexBasis:I?"100%":"auto"},children:(0,i.jsxs)(l.Z,{onClick:P,children:[(0,i.jsx)(f,{sx:{paddingRight:1,fontSize:"1.8rem"}}),(0,i.jsx)(a.Z,{sx:{display:"flex",alignItems:"baseline",width:70},children:r.round>0?"Resume":"Run"})]})}),(0,i.jsx)(a.Z,{sx:{flexBasis:I?"100%":"auto"},children:(0,i.jsxs)(l.Z,{color:"error",onClick:()=>m(!0),children:[(0,i.jsx)(g.Z,{sx:{paddingRight:1,fontSize:"1.8rem"}}),"Delete"]})})]})]},r.id),(0,i.jsxs)(C.Z,{open:p,onClose:()=>m(!1),children:[(0,i.jsxs)(w.Z,{children:["Delete encounter ",r.name,"?"]}),(0,i.jsx)(N.Z,{children:(0,i.jsx)(k.Z,{children:"This action cannot be undone."})}),(0,i.jsxs)(T.Z,{children:[(0,i.jsx)(l.Z,{variant:"contained",onClick:()=>m(!1),children:"Cancel"}),(0,i.jsxs)(l.Z,{variant:"contained",onClick:()=>{c().then(e=>{var n,r;let{data:i}=e;(null==i?void 0:null===(n=i.campaign)||void 0===n?void 0:null===(r=n.encounter)||void 0===r?void 0:r.delete)&&(o(),m(!1))})},color:"error",children:[(0,i.jsx)(g.Z,{})," Delete"]})]})]})]})}function _(e){let{listName:n,noEncountersMessage:r,campaign:o,encounters:s,refetch:l}=e;return(0,i.jsxs)(a.Z,{mt:4,children:[(0,i.jsx)(t.Z,{variant:"h4",children:n}),(0,i.jsx)(v.Z,{sx:{marginTop:2,paddingTop:0,border:0,borderTop:2,borderStyle:"solid",borderColor:"primary.light"},children:s&&s.length>0?s.map(e=>(0,i.jsx)(P,{campaign:o,encounter:e,refetch:l},e.id)):(0,i.jsx)(j.ZP,{sx:{border:0,borderBottom:1,borderStyle:"solid",borderColor:"grey.400"},children:(0,i.jsx)(Z.Z,{children:r})})})]})}function R(e){let{campaign:n,encounters:r,refetch:o}=e,[s]=(0,h.u9)(),t=(0,x.useMemo)(()=>null==r?void 0:r.find(e=>{var r;return e.id===(null===(r=n.activeEncounter)||void 0===r?void 0:r.id)}),[r,n]),a=(0,x.useMemo)(()=>null==r?void 0:r.filter(e=>{var r;return e.round>0&&e.id!==(null===(r=n.activeEncounter)||void 0===r?void 0:r.id)}),[r,n]),c=(0,x.useMemo)(()=>null==r?void 0:r.filter(e=>{var r;return!e.round&&e.id!==(null===(r=n.activeEncounter)||void 0===r?void 0:r.id)}),[r,n]),d=(0,x.useCallback)(()=>{n&&s({variables:{id:n.id,input:{name:n.name,activeEncounter:null}}})},[s,n]);return(0,i.jsxs)(i.Fragment,{children:[t?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(_,{listName:"Active Encounter",noEncountersMessage:"No Active Encounter",campaign:n,encounters:[t],refetch:o}),(0,i.jsxs)(l.Z,{disabled:!(null==n?void 0:n.activeEncounter),onClick:d,children:[(0,i.jsx)(m,{}),"Clear Active Encounter"]})]}):null,(0,i.jsx)(_,{listName:"In Progress Encounters",noEncountersMessage:"No In Progress Encounters",campaign:n,encounters:a,refetch:o}),(0,i.jsx)(_,{listName:"Planned Encounters",noEncountersMessage:"No Planned Encounters",campaign:n,encounters:c,refetch:o})]})}function B(){var e;let n=(0,u.useRouter)(),{campaignId:r}=n.query,{data:c}=(0,h.mU)({variables:{id:r}}),{data:p,refetch:m}=(0,h.g8)({variables:{campaignId:r},skip:!r}),[v]=(0,h.$p)(),j=(0,x.useCallback)(()=>{v({variables:{encounter:{campaignId:r,name:"New Encounter"}}}).then(e=>{var i,o;let{data:s}=e;(null==s?void 0:null===(i=s.campaign)||void 0===i?void 0:null===(o=i.encounter)||void 0===o?void 0:o.save)&&n.push("/".concat(r,"/encounter/").concat(s.campaign.encounter.save.id,"/edit")),m()})},[v,r,n,m]);return(null==c?void 0:c.campaign)&&(null==p?void 0:null===(e=p.campaign)||void 0===e?void 0:e.encounters)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d(),{children:(0,i.jsx)("title",{children:"List Encounters | OBS GM Overlay"})}),(0,i.jsxs)(s.Z,{fixed:!0,children:[(0,i.jsx)(t.Z,{variant:"h3",children:"Encounters"}),(0,i.jsx)(R,{campaign:c.campaign,encounters:p.campaign.encounters,refetch:m}),(0,i.jsx)(a.Z,{sx:{display:"flex",justifyContent:"end"},children:(0,i.jsxs)(l.Z,{variant:"contained",color:"success",onClick:j,children:[(0,i.jsx)(o.Z,{})," New Encounter"]})})]})]}):null}}},function(e){e.O(0,[387,934,774,888,179],function(){return e(e.s=3315)}),_N_E=e.O()}]);