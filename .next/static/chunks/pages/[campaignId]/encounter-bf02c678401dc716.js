(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[969],{2762:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>P});var t=r(37876),i=r(92989),s=r(87460),o=r(61428),a=r(2312),l=r(32643),c=r(77328),d=r.n(c),u=r(89099),p=r(14232),x=r(71257);let m=(0,x.A)((0,t.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");var h=r(57982),A=r(40510),v=r(83694),y=r(83690),j=r(25878);let g=(0,x.A)((0,t.jsx)("path",{d:"M8 5v14l11-7z"}),"PlayArrow");var f=r(92781),b=r(60964),E=r(11863),w=r(65657),C=r(97444),k=r(34293),N=r(59256),T=r(72528),I=r(48230),_=r.n(I);function M(e){let{campaign:n,encounter:r,refetch:i}=e,s=(0,u.useRouter)(),[c]=(0,h.J1)({variables:{campaignId:n.id,encounterId:null==r?void 0:r.id}}),[d]=(0,h.O)({variables:{campaignId:n.id,encounterId:r.id},refetchQueries:[h.ki]}),[x,m]=(0,p.useState)(!1),A=(0,b.A)(),I=(0,E.A)(A.breakpoints.only("xs")),M=(0,p.useCallback)(()=>{d().then(e=>{var r,t;let{data:i}=e;(null==i||null==(t=i.campaign)||null==(r=t.encounter)?void 0:r.setActive)&&s.push("/".concat(n.id,"/encounter/run"))})},[d,s,n.id]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(v.Ay,{sx:{flexWrap:"wrap",border:0,borderBottom:1,borderStyle:"solid",borderColor:"grey.400"},children:[(0,t.jsx)(y.A,{sx:{flexBasis:"100%"},children:(0,t.jsxs)(a.A,{display:"flex",justifyContent:"space-between",width:"100%",children:[(0,t.jsx)(o.A,{variant:"h5",component:"span",children:r.name}),r.round>0?(0,t.jsxs)(o.A,{variant:"h6",color:"text.secondary",component:"span",children:["(Round ",r.round,")"]}):null]})}),(0,t.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",width:"100%"},children:[(0,t.jsx)(a.A,{sx:{flexGrow:1,flexBasis:I?"100%":"auto"},children:(0,t.jsx)(_(),{href:"/".concat(n.id,"/encounter/").concat(r.id,"/edit"),children:(0,t.jsxs)(l.A,{component:"span",children:[(0,t.jsx)(j.A,{sx:{paddingRight:1,fontSize:"1.8rem"}}),"Edit"]})})}),(0,t.jsx)(a.A,{sx:{flexGrow:1,flexBasis:I?"100%":"auto"},children:(0,t.jsxs)(l.A,{onClick:M,children:[(0,t.jsx)(g,{sx:{paddingRight:1,fontSize:"1.8rem"}}),(0,t.jsx)(a.A,{sx:{display:"flex",alignItems:"baseline",width:70},children:r.round>0?"Resume":"Run"})]})}),(0,t.jsx)(a.A,{sx:{flexBasis:I?"100%":"auto"},children:(0,t.jsxs)(l.A,{color:"error",onClick:()=>m(!0),children:[(0,t.jsx)(f.A,{sx:{paddingRight:1,fontSize:"1.8rem"}}),"Delete"]})})]})]},r.id),(0,t.jsxs)(w.A,{open:x,onClose:()=>m(!1),children:[(0,t.jsxs)(C.A,{children:["Delete encounter ",r.name,"?"]}),(0,t.jsx)(k.A,{children:(0,t.jsx)(N.A,{children:"This action cannot be undone."})}),(0,t.jsxs)(T.A,{children:[(0,t.jsx)(l.A,{variant:"contained",onClick:()=>m(!1),children:"Cancel"}),(0,t.jsxs)(l.A,{variant:"contained",onClick:()=>{c().then(e=>{var n,r;let{data:t}=e;(null==t||null==(r=t.campaign)||null==(n=r.encounter)?void 0:n.delete)&&(i(),m(!1))})},color:"error",children:[(0,t.jsx)(f.A,{})," Delete"]})]})]})]})}function R(e){let{listName:n,noEncountersMessage:r,campaign:i,encounters:s,refetch:l}=e;return(0,t.jsxs)(a.A,{mt:4,children:[(0,t.jsx)(o.A,{variant:"h4",children:n}),(0,t.jsx)(A.A,{sx:{marginTop:2,paddingTop:0,border:0,borderTop:2,borderStyle:"solid",borderColor:"primary.light"},children:s&&s.length>0?s.map(e=>(0,t.jsx)(M,{campaign:i,encounter:e,refetch:l},e.id)):(0,t.jsx)(v.Ay,{sx:{border:0,borderBottom:1,borderStyle:"solid",borderColor:"grey.400"},children:(0,t.jsx)(y.A,{children:r})})})]})}function B(e){let{campaign:n,encounters:r,refetch:i}=e,[s]=(0,h.sF)(),o=(0,p.useMemo)(()=>null==r?void 0:r.find(e=>{var r;return e.id===(null==(r=n.activeEncounter)?void 0:r.id)}),[r,n]),a=(0,p.useMemo)(()=>null==r?void 0:r.filter(e=>{var r;return e.round>0&&e.id!==(null==(r=n.activeEncounter)?void 0:r.id)}),[r,n]),c=(0,p.useMemo)(()=>null==r?void 0:r.filter(e=>{var r;return!e.round&&e.id!==(null==(r=n.activeEncounter)?void 0:r.id)}),[r,n]),d=(0,p.useCallback)(()=>{n&&s({variables:{id:n.id,input:{name:n.name,activeEncounter:null}}})},[s,n]);return(0,t.jsxs)(t.Fragment,{children:[o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(R,{listName:"Active Encounter",noEncountersMessage:"No Active Encounter",campaign:n,encounters:[o],refetch:i}),(0,t.jsxs)(l.A,{disabled:!(null==n?void 0:n.activeEncounter),onClick:d,children:[(0,t.jsx)(m,{}),"Clear Active Encounter"]})]}):null,(0,t.jsx)(R,{listName:"In Progress Encounters",noEncountersMessage:"No In Progress Encounters",campaign:n,encounters:a,refetch:i}),(0,t.jsx)(R,{listName:"Planned Encounters",noEncountersMessage:"No Planned Encounters",campaign:n,encounters:c,refetch:i})]})}function P(){var e;let n=(0,u.useRouter)(),{campaignId:r}=n.query,{data:c}=(0,h.N$)({variables:{id:r}}),{data:x,refetch:m}=(0,h.oy)({variables:{campaignId:r},skip:!r}),[A]=(0,h.BE)(),v=(0,p.useCallback)(()=>{A({variables:{encounter:{campaignId:r,name:"New Encounter"}}}).then(e=>{var t,i;let{data:s}=e;(null==s||null==(i=s.campaign)||null==(t=i.encounter)?void 0:t.save)&&n.push("/".concat(r,"/encounter/").concat(s.campaign.encounter.save.id,"/edit")),m()})},[A,r,n,m]);return(null==c?void 0:c.campaign)&&(null==x||null==(e=x.campaign)?void 0:e.encounters)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d(),{children:(0,t.jsx)("title",{children:"List Encounters | OBS GM Overlay"})}),(0,t.jsxs)(s.A,{fixed:!0,children:[(0,t.jsx)(o.A,{variant:"h3",children:"Encounters"}),(0,t.jsx)(B,{campaign:c.campaign,encounters:x.campaign.encounters,refetch:m}),(0,t.jsx)(a.A,{sx:{display:"flex",justifyContent:"end"},children:(0,t.jsxs)(l.A,{variant:"contained",color:"success",onClick:v,children:[(0,t.jsx)(i.A,{})," New Encounter"]})})]})]}):null}},33185:(e,n,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/[campaignId]/encounter",function(){return r(2762)}])},83690:(e,n,r)=>{"use strict";r.d(n,{A:()=>h});var t=r(14232),i=r(69241),s=r(13323),o=r(26172),a=r(61428),l=r(16749),c=r(57947),d=r(30985),u=r(45758),p=r(74778),x=r(37876);let m=(0,c.Ay)("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,n)=>{let{ownerState:r}=e;return[{["& .".concat(u.A.primary)]:n.primary},{["& .".concat(u.A.secondary)]:n.secondary},n.root,r.inset&&n.inset,r.primary&&r.secondary&&n.multiline,r.dense&&n.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[".".concat(o.A.root,":where(& .").concat(u.A.primary,")")]:{display:"block"},[".".concat(o.A.root,":where(& .").concat(u.A.secondary,")")]:{display:"block"},variants:[{props:e=>{let{ownerState:n}=e;return n.primary&&n.secondary},style:{marginTop:6,marginBottom:6}},{props:e=>{let{ownerState:n}=e;return n.inset},style:{paddingLeft:56}}]}),h=t.forwardRef(function(e,n){let r=(0,d.b)({props:e,name:"MuiListItemText"}),{children:o,className:c,disableTypography:h=!1,inset:A=!1,primary:v,primaryTypographyProps:y,secondary:j,secondaryTypographyProps:g,slots:f={},slotProps:b={},...E}=r,{dense:w}=t.useContext(l.A),C=null!=v?v:o,k=j,N={...r,disableTypography:h,inset:A,primary:!!C,secondary:!!k,dense:w},T=(e=>{let{classes:n,inset:r,primary:t,secondary:i,dense:o}=e;return(0,s.A)({root:["root",r&&"inset",o&&"dense",t&&i&&"multiline"],primary:["primary"],secondary:["secondary"]},u.b,n)})(N),I={slots:f,slotProps:{primary:y,secondary:g,...b}},[_,M]=(0,p.A)("root",{className:(0,i.A)(T.root,c),elementType:m,externalForwardedProps:{...I,...E},ownerState:N,ref:n}),[R,B]=(0,p.A)("primary",{className:T.primary,elementType:a.A,externalForwardedProps:I,ownerState:N}),[P,S]=(0,p.A)("secondary",{className:T.secondary,elementType:a.A,externalForwardedProps:I,ownerState:N});return null==C||C.type===a.A||h||(C=(0,x.jsx)(R,{variant:w?"body2":"body1",component:(null==B?void 0:B.variant)?void 0:"span",...B,children:C})),null==k||k.type===a.A||h||(k=(0,x.jsx)(P,{variant:"body2",color:"textSecondary",...S,children:k})),(0,x.jsxs)(_,{...M,children:[C,k]})})}},e=>{e.O(0,[46,798,99,636,593,792],()=>e(e.s=33185)),_N_E=e.O()}]);