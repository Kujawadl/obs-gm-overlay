(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[27],{42282:(e,n,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/[campaignId]/encounter/run",function(){return r(51445)}])},44689:(e,n,r)=>{"use strict";r.d(n,{A:()=>p});var t=r(37876),o=r(61428),i=r(2312),a=r(77328),l=r.n(a),d=r(54587),s=r.n(d),c=r(14232),u=r(67009),m=r(57982),v=r(74110);function p(e){var n;let{campaign:r,style:a="overlay",forceShowMonsterNames:d=!1}=e,{hideMonsterNames:p,round:h,turn:x,turnStart:g}=(0,c.useMemo)(()=>{var e;return null!=(e=null==r?void 0:r.activeEncounter)?e:{hideMonsterNames:m.F3.Always,round:0,turn:0,turnStart:null}},[r]),b=(0,c.useMemo)(()=>{var e,n;return null!=(n=null==r||null==(e=r.activeEncounter)?void 0:e.combatants.sort((e,n)=>e.turnOrder-n.turnOrder))?n:[]},[r]),[f,y]=(0,c.useState)(null),[w,j]=(0,c.useState)(!1);return(0,u.A)(()=>{if((h>0||x>0)&&g){let e=new Date,n=(0,v._U)(g);y((0,v.zA)((0,v._U)(g),e,["minutes","seconds"])),j(e.getTime()-n.getTime()>6e4)}else f&&(y(null),j(!1))},1e3),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l(),{children:(0,t.jsx)("title",{children:"".concat(null!=(n=null==r?void 0:r.name)?n:"Campaign"," Initiative | OBS GM Overlay")})}),(0,t.jsxs)(o.A,{variant:"h5",sx:"overlay"===a?{marginLeft:2,marginRight:2}:{paddingTop:2,paddingBottom:2,paddingLeft:4,paddingRight:4,border:0,borderStyle:"solid",borderTop:2,borderTopColor:"primary.light",borderBottom:1,borderBottomColor:"grey.400"},children:[h?"Round ".concat(h):"Combat Not Started",(0,t.jsx)(i.A,{className:w?"blink":void 0,sx:{color:w?"error.main":"text.secondary",display:"inline-flex"},children:f?"(".concat(f,")"):(0,t.jsx)(i.A,{sx:{display:"inline-block",width:62}})})]}),"overlay"===a&&(0,t.jsx)("hr",{style:{width:"100%",padding:0,border:"none",borderTop:"medium double #333",color:"#333"}}),b.map((e,n)=>(0,t.jsxs)(i.A,{sx:"overlay"===a?{display:"flex",flexDirection:"row",alignItems:"center",height:32}:{display:"flex",flexDirection:"row",alignItems:"center",height:32,marginTop:2,paddingBottom:2,border:0,borderBottom:1,borderStyle:"solid",borderColor:"grey.400"},children:[(0,t.jsx)(i.A,{sx:{width:32,display:"inline-block",marginBottom:"-6px"},children:e.turnOrder===x&&(0,t.jsx)(s(),{src:"/d20.png",alt:"d20",height:32,width:32})}),(0,t.jsx)(i.A,{sx:{fontWeight:e.turnOrder===x?"bold":void 0,textDecoration:e.turnOrder===x?"underline":void 0},children:d?e.name:function(){switch(p){case m.F3.Always:if(!e.public)return"???";break;case m.F3.UntilTurn:if(!e.public&&x<e.turnOrder&&h<=1)return"???";break;default:return e.name}}()})]},"combatant_".concat(n,"_").concat(e)))]})}},51445:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>y});var t=r(37876),o=r(14232),i=r(87460),a=r(61428),l=r(2312),d=r(32643),s=r(71257);let c=(0,s.A)((0,t.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos"),u=(0,s.A)((0,t.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),m=(0,s.A)((0,t.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos");var v=r(77328),p=r.n(v),h=r(89099),x=r(74023),g=r.n(x),b=r(44689),f=r(57982);function y(){var e,n;let{campaignId:r}=(0,h.useRouter)().query,{data:s}=(0,f.N$)({variables:{id:r}}),v=(0,o.useMemo)(()=>null==s?void 0:s.campaign,[s]),[x,{loading:y}]=(0,f.rE)(),[w]=(0,f.BE)({variables:{encounter:{...g()(null==v?void 0:v.activeEncounter,"__typename","combatants"),campaignId:r,round:0,turn:0,turnStart:null}},refetchQueries:[f.ki]}),j=(0,o.useCallback)(()=>{var e;return x({variables:{campaignId:null==v?void 0:v.id,encounterId:null==v||null==(e=v.activeEncounter)?void 0:e.id,forward:!0}})},[x,v]),A=(0,o.useCallback)(()=>{var e;return x({variables:{campaignId:null==v?void 0:v.id,encounterId:null==v||null==(e=v.activeEncounter)?void 0:e.id,forward:!1}})},[x,v]);return v&&v.activeEncounter&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p(),{children:(0,t.jsx)("title",{children:"".concat(null!=(n=null==s||null==(e=s.campaign)?void 0:e.name)?n:"Campaign"," Initiative | OBS GM Overlay")})}),(0,t.jsxs)(i.A,{fixed:!0,children:[(0,t.jsx)(a.A,{variant:"h3",mb:2,children:v.activeEncounter.name}),(0,t.jsx)(b.A,{campaign:v,style:"editor",forceShowMonsterNames:!0}),(0,t.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",marginTop:2},children:[(0,t.jsxs)(d.A,{variant:"contained",color:"secondary",onClick:A,disabled:y||0===v.activeEncounter.round,children:[(0,t.jsx)(c,{}),"Previous"]}),(0,t.jsxs)(d.A,{disabled:y||0===v.activeEncounter.round,onClick:()=>w(),children:[(0,t.jsx)(u,{}),"Restart"]}),(0,t.jsxs)(d.A,{variant:"contained",color:"primary",onClick:j,disabled:y,children:["Next ",(0,t.jsx)(m,{})]})]})]})]})}},74110:(e,n,r)=>{"use strict";r.d(n,{zA:()=>l,_U:()=>o,$t:()=>v});var t=r(20622);function o(e){return e instanceof Date?e:e?(0,t.H)(e):void 0}var i=r(63253),a=r(21175);function l(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["hours","minutes","seconds"],t={xSeconds:"{{count}}",xMinutes:"{{count}}",xHours:"{{count}}"},o=(0,i.F)({start:e,end:n});return(0,a.a)(o,{format:r,locale:{formatDistance:(e,n)=>{var r,o;return null!=(o=null==(r=t[e])?void 0:r.replace("{{count}}",null==n?void 0:n.toString().padStart(2,"0")))?o:""}},delimiter:":",zero:!0}).replace(/^0(\d)/,"$1")}var d=r(14232),s=r(67009),c=r(12858),u=r(10887);function m(e){let{player:n,campaign:r}=e;if(!n||!r||!r.gmInspiration&&n.isGM||"none"===r.cooldownType)return 0;let t=o("player"===r.cooldownType?n.lastInspirationUsed:r.lastInspirationUsed),i=(0,c.z)(t,r.cooldownTime);return i>new Date?(0,u.O)(i,new Date):0}function v(e){var n;let{player:r,campaign:t}=e,[o,i]=(0,d.useState)(m({player:r,campaign:t}));return(0,d.useEffect)(()=>{i(m({player:r,campaign:t}))},[r,t]),(0,s.A)(()=>{i(m({player:r,campaign:t}))},t&&"none"===t.cooldownType?null:1e3),{cooldownTimeRemaining:o,percentComplete:Math.round(o/((null!=(n=null==t?void 0:t.cooldownTime)?n:0)*60)*100),formattedDuration:(0,a.a)({hours:Math.trunc(o/60/60),minutes:Math.trunc(o/60%60),seconds:Math.trunc(o%60)},{format:["hours","minutes","seconds"]})}}}},e=>{e.O(0,[46,231,587,23,636,593,792],()=>e(e.s=42282)),_N_E=e.O()}]);