(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[422],{6574:function(e,n,r){"use strict";var t=r(518),o=r(8216),i=r(948),a=r(1657);let l=(0,t.Z)({createStyledComponent:(0,i.ZP)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,n)=>{let{ownerState:r}=e;return[n.root,n[`maxWidth${(0,o.Z)(String(r.maxWidth))}`],r.fixed&&n.fixed,r.disableGutters&&n.disableGutters]}}),useThemeProps:e=>(0,a.Z)({props:e,name:"MuiContainer"})});n.Z=l},2999:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[campaignId]/encounter/run",function(){return r(5779)}])},2153:function(e,n,r){"use strict";r.d(n,{Z:function(){return p}});var t=r(5893),o=r(5861),i=r(9226),a=r(9008),l=r.n(a),d=r(5675),u=r.n(d),c=r(7294),s=r(3337),v=r(8054),m=r(4505);function p(e){var n,r;let{campaign:a,style:d="overlay",forceShowMonsterNames:p=!1}=e,{hideMonsterNames:f,round:h,turn:x,turnStart:g}=(0,c.useMemo)(()=>null!==(n=null==a?void 0:a.activeEncounter)&&void 0!==n?n:{hideMonsterNames:v.NJ.Always,round:0,turn:0,turnStart:null},[a]),b=(0,c.useMemo)(()=>{var e,n;return null!==(n=null==a?void 0:null===(e=a.activeEncounter)||void 0===e?void 0:e.combatants.sort((e,n)=>e.turnOrder-n.turnOrder))&&void 0!==n?n:[]},[a]),[y,w]=(0,c.useState)(null),[j,Z]=(0,c.useState)(!1);return(0,s.Z)(()=>{if((h>0||x>0)&&g){let e=new Date,n=(0,m.sG)(g);w((0,m.J_)(e,(0,m.sG)(g),["minutes","seconds"])),Z(e.getTime()-n.getTime()>6e4)}else y&&(w(null),Z(!1))},1e3),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l(),{children:(0,t.jsx)("title",{children:"".concat(null!==(r=null==a?void 0:a.name)&&void 0!==r?r:"Campaign"," Initiative | OBS GM Overlay")})}),(0,t.jsxs)(o.Z,{variant:"h5",sx:"overlay"===d?{marginLeft:2,marginRight:2}:{paddingTop:2,paddingBottom:2,paddingLeft:4,paddingRight:4,border:0,borderStyle:"solid",borderTop:2,borderTopColor:"primary.light",borderBottom:1,borderBottomColor:"grey.400"},children:[h?"Round ".concat(h):"Combat Not Started",(0,t.jsx)(i.Z,{className:j?"blink":void 0,sx:{color:j?"error.main":"text.secondary",display:"inline-flex"},children:y?"(".concat(y,")"):(0,t.jsx)(i.Z,{sx:{display:"inline-block",width:62}})})]}),"overlay"===d&&(0,t.jsx)("hr",{style:{width:"100%",padding:0,border:"none",borderTop:"medium double #333",color:"#333"}}),b.map((e,n)=>(0,t.jsxs)(i.Z,{sx:"overlay"===d?{display:"flex",flexDirection:"row",alignItems:"center",height:32}:{display:"flex",flexDirection:"row",alignItems:"center",height:32,marginTop:2,paddingBottom:2,border:0,borderBottom:1,borderStyle:"solid",borderColor:"grey.400"},children:[(0,t.jsx)(i.Z,{sx:{width:32,display:"inline-block",marginBottom:"-6px"},children:e.turnOrder===x&&(0,t.jsx)(u(),{src:"/d20.png",alt:"d20",height:32,width:32})}),(0,t.jsx)(i.Z,{sx:{fontWeight:e.turnOrder===x?"bold":void 0,textDecoration:e.turnOrder===x?"underline":void 0},children:p?e.name:function(){switch(f){case v.NJ.Always:if(!e.public)return"???";case v.NJ.UntilTurn:if(!e.public&&x<e.turnOrder&&h<=1)return"???";default:return e.name}}()})]},"combatant_".concat(n,"_").concat(e)))]})}},5779:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return y}});var t=r(5893),o=r(7294),i=r(6574),a=r(5861),l=r(9226),d=r(3321),u=r(8169),c=(0,u.Z)((0,t.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos"),s=(0,u.Z)((0,t.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"}),"History"),v=(0,u.Z)((0,t.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos"),m=r(9008),p=r.n(m),f=r(1163),h=r(7557),x=r.n(h),g=r(2153),b=r(8054);function y(){var e,n;let r=(0,f.useRouter)(),{campaignId:u}=r.query,{data:m}=(0,b.mU)({variables:{id:u}}),h=(0,o.useMemo)(()=>null==m?void 0:m.campaign,[m]),[y,{loading:w}]=(0,b.kf)(),[j]=(0,b.$p)({variables:{encounter:{...x()(null==h?void 0:h.activeEncounter,"__typename","combatants"),campaignId:u,round:0,turn:0,turnStart:null}},refetchQueries:[b.N8]}),Z=(0,o.useCallback)(()=>{var e;return y({variables:{campaignId:null==h?void 0:h.id,encounterId:null==h?void 0:null===(e=h.activeEncounter)||void 0===e?void 0:e.id,forward:!0}})},[y,h]),C=(0,o.useCallback)(()=>{var e;return y({variables:{campaignId:null==h?void 0:h.id,encounterId:null==h?void 0:null===(e=h.activeEncounter)||void 0===e?void 0:e.id,forward:!1}})},[y,h]);return h&&h.activeEncounter&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p(),{children:(0,t.jsx)("title",{children:"".concat(null!==(n=null==m?void 0:null===(e=m.campaign)||void 0===e?void 0:e.name)&&void 0!==n?n:"Campaign"," Initiative | OBS GM Overlay")})}),(0,t.jsxs)(i.Z,{fixed:!0,children:[(0,t.jsx)(a.Z,{variant:"h3",mb:2,children:h.activeEncounter.name}),(0,t.jsx)(g.Z,{campaign:h,style:"editor",forceShowMonsterNames:!0}),(0,t.jsxs)(l.Z,{sx:{display:"flex",justifyContent:"space-between",marginTop:2},children:[(0,t.jsxs)(d.Z,{variant:"contained",color:"secondary",onClick:C,disabled:w||0===h.activeEncounter.round,children:[(0,t.jsx)(c,{}),"Previous"]}),(0,t.jsxs)(d.Z,{disabled:w||0===h.activeEncounter.round,onClick:()=>j(),children:[(0,t.jsx)(s,{}),"Restart"]}),(0,t.jsxs)(d.Z,{variant:"contained",color:"primary",onClick:Z,disabled:w,children:["Next ",(0,t.jsx)(v,{})]})]})]})]})}},4505:function(e,n,r){"use strict";r.d(n,{J_:function(){return l},sG:function(){return o},qI:function(){return m},y1:function(){return p}});var t=r(3595);function o(e){return e instanceof Date?e:(0,t.D)(e)}var i=r(2290),a=r(2090);function l(e,n){var r;let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["hours","minutes","seconds"],o={xSeconds:"{{count}}",xMinutes:"{{count}}",xHours:"{{count}}"},l=(0,i.y)({start:e,end:n});return(0,a.L)(l,{format:t,locale:{formatDistance:(e,n)=>{var t;return null!==(r=null===(t=o[e])||void 0===t?void 0:t.replace("{{count}}",null==n?void 0:n.toString().padStart(2,"0")))&&void 0!==r?r:""}},delimiter:":",zero:!0}).replace(/^0(\d)/,"$1")}var d=r(7294),u=r(3337),c=r(3732),s=r(209);function v(e){let{player:n,campaign:r}=e;if(!n||!r||!r.gmInspiration&&n.isGM||"none"===r.cooldownType)return 0;let t=o("player"===r.cooldownType?n.lastInspirationUsed:r.lastInspirationUsed),i=(0,c.m)(t,r.cooldownTime),a=i>new Date,l=a?(0,s.c)(i,new Date):0;return l}function m(e){var n;let{player:r,campaign:t}=e,[o,i]=(0,d.useState)(v({player:r,campaign:t}));return(0,d.useEffect)(()=>{i(v({player:r,campaign:t}))},[r,t]),(0,u.Z)(()=>{i(v({player:r,campaign:t}))},t&&"none"===t.cooldownType?null:1e3),{cooldownTimeRemaining:o,percentComplete:Math.round(o/((null!==(n=null==t?void 0:t.cooldownTime)&&void 0!==n?n:0)*60)*100),formattedDuration:(0,a.L)({hours:Math.trunc(o/60/60),minutes:Math.trunc(o/60%60),seconds:Math.trunc(o%60)},{format:["hours","minutes","seconds"]})}}function p(e,n){let r=(0,d.useRef)();return(0,d.useCallback)(function(){for(var t=arguments.length,o=Array(t),i=0;i<t;i++)o[i]=arguments[i];let a=()=>{clearTimeout(r.current),e(...o)};clearTimeout(r.current),r.current=window.setTimeout(a,n)},[e,n])}}},function(e){e.O(0,[948,675,557,774,888,179],function(){return e(e.s=2999)}),_N_E=e.O()}]);