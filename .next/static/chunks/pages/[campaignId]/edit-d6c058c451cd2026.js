(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[209],{1147:function(e,n,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[campaignId]/edit",function(){return i(533)}])},533:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return Q}});var r=i(5893),t=i(6574),a=i(9008),l=i.n(a),s=i(1163),o=i(2175),c=i(2734),d=i(8396),u=i(5861),x=i(6886),m=i(1903),h=i(480),p=i(9653),j=i(4054),v=i(3841),y=i(315),Z=i(9840),g=i(3321),b=i(7294),f=i(6310),C=i(8054),T=i(9226),w=i(8462),M=i(891),N=i(2428),k=i(8456),P=i(8169),I=(0,P.Z)((0,r.jsx)("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zM4 12c0-4.4 3.6-8 8-8 1.8 0 3.5.6 4.9 1.7L5.7 16.9C4.6 15.5 4 13.8 4 12zm8 8c-1.8 0-3.5-.6-4.9-1.7L18.3 7.1C19.4 8.5 20 10.2 20 12c0 4.4-3.6 8-8 8z"}),"DoNotDisturbAlt"),S=(0,P.Z)((0,r.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"}),"Save"),G=i(3946);function _(e){let{icon:n,text:i,...t}=e,a=(0,c.Z)(),l=(0,d.Z)(a.breakpoints.only("xs"));return l?(0,r.jsx)(G.Z,{...t,children:n}):(0,r.jsx)(g.Z,{...t,children:i})}let z=f.Ry().shape({playerName:f.Z_().required("Player Name is required")});function D(e){let{player:n,campaignId:i,setEditing:t,onCancelAdd:a}=e,[l,{loading:s}]=(0,C.x8)(),c=(0,b.useMemo)(()=>({playerName:(null==n?void 0:n.playerName)||"",characterName:(null==n?void 0:n.characterName)||"",isGM:(null==n?void 0:n.isGM)||!1}),[null==n?void 0:n.playerName,null==n?void 0:n.characterName,null==n?void 0:n.isGM]),d=(0,b.useCallback)(async e=>{l({variables:{id:null==n?void 0:n.id,input:{campaignId:i,...e}}}).then(()=>{n||a(),t(!1)})},[n,i,l,a,t]);return(0,r.jsx)(o.J9,{initialValues:c,onSubmit:d,validationSchema:z,children:e=>{let{values:i,isValid:l}=e;return(0,r.jsx)(o.l0,{style:{flexBasis:"100%"},children:(0,r.jsxs)(x.ZP,{container:!0,spacing:2,alignItems:"center",mr:-2,children:[(0,r.jsx)(x.ZP,{item:!0,xs:8,md:3,children:(0,r.jsx)(o.gN,{name:"playerName",children:e=>{let{field:n,meta:i}=e;return(0,r.jsx)(m.Z,{required:!0,id:"playerName",label:"Player Name",fullWidth:!0,autoFocus:!0,error:i.touched&&!!i.error,helperText:i.touched?i.error:void 0,...n})}})}),(0,r.jsx)(x.ZP,{item:!0,xs:4,md:3,sx:{display:"flex",justifyContent:"center"},children:(0,r.jsx)(o.gN,{name:"isGM",children:e=>{let{field:n}=e;return(0,r.jsx)(h.Z,{id:"isGM",label:"GM",labelPlacement:"start",control:(0,r.jsx)(p.Z,{color:"primary",checked:n.value,...n})})}})}),(0,r.jsx)(x.ZP,{item:!0,xs:8,md:3,children:(0,r.jsx)(o.gN,{name:"characterName",children:e=>{let{field:n}=e;return(0,r.jsx)(m.Z,{id:"characterName",label:"Character Name",disabled:i.isGM,sx:{visibility:i.isGM?"hidden":void 0},fullWidth:!0,...n})}})}),(0,r.jsxs)(x.ZP,{item:!0,xs:4,md:3,sx:{display:"flex",justifyContent:"flex-end"},children:[(0,r.jsx)(_,{variant:"contained",color:"secondary",sx:{mr:1},onClick:()=>{n||a(),t(!1)},icon:(0,r.jsx)(I,{}),text:"Cancel"}),s?(0,r.jsx)(k.Z,{}):(0,r.jsx)(_,{type:"submit",variant:"contained",color:"primary",disabled:!l||s,icon:(0,r.jsx)(S,{}),text:"Save"})]})]})})}})}var E=(0,P.Z)((0,r.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"}),"Restore"),q=(0,P.Z)((0,r.jsx)("path",{d:"M19 13H5v-2h14v2z"}),"Remove"),R=i(1797),A=i(6761),F=i(7383),W=i(657),H=i(7645),L=i(6580),B=i(8951),V=i(1425),O=i(4505);function U(e){let{player:n,campaign:i,setEditing:t}=e,[a,l]=(0,b.useState)(!1),[s]=(0,C.UB)(),[o]=(0,C.ks)({variables:{id:n.id}}),[u]=(0,C.os)({variables:{id:n.id}}),h=(0,c.Z)(),p=(0,d.Z)(h.breakpoints.only("xs")),{cooldownTimeRemaining:j,percentComplete:v,formattedDuration:y}=(0,O.qI)({player:n,campaign:i}),Z=(0,b.useCallback)(e=>{s({variables:{id:n.id,inspiration:e.target.value?Math.max(parseInt(e.target.value,10),0):0}})},[n.id,s]),f=(0,b.useCallback)(()=>{s({variables:{id:n.id,inspiration:n.inspiration+1}})},[n.id,n.inspiration,s]),w=(0,b.useCallback)(()=>{s({variables:{id:n.id,inspiration:Math.max(n.inspiration-1,0)}})},[n.id,n.inspiration,s]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(x.ZP,{container:!0,alignItems:"center",children:[(0,r.jsxs)(x.ZP,{item:!0,xs:8,children:[(0,r.jsx)(T.Z,{component:"span",sx:{fontWeight:"bold",paddingRight:1},children:n.playerName}),!p&&(n.characterName||n.isGM)&&(0,r.jsxs)(T.Z,{component:"span",sx:{color:"text.secondary"},children:["(",n.isGM?"GM":n.characterName,")"]})]}),(0,r.jsxs)(x.ZP,{item:!0,xs:4,sx:{display:"flex",justifyContent:"flex-end"},children:[j>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(G.Z,{onClick:()=>u(),children:(0,r.jsx)(E,{})}),(0,r.jsx)(F.Z,{title:"".concat(y," remaining on cooldown"),children:(0,r.jsx)(k.Z,{variant:"determinate",size:"1.5rem",sx:{alignSelf:"center",textAlign:"center",margin:"calc(calc(40px - 1.5rem) / 2)",flex:"0 0 auto"},value:v})})]}):(0,r.jsx)(G.Z,{onClick:w,sx:{visibility:i.gmInspiration||!n.isGM?"visible":"hidden"},children:(0,r.jsx)(q,{})}),(0,r.jsx)(m.Z,{inputProps:{inputMode:"numeric",pattern:"[0-9]*",style:{textAlign:"center"}},size:"small",sx:{minWidth:50,maxWidth:50,visibility:i.gmInspiration||!n.isGM?"visible":"hidden"},value:n.inspiration,onChange:Z}),(0,r.jsx)(G.Z,{onClick:f,sx:{visibility:i.gmInspiration||!n.isGM?"visible":"hidden"},children:(0,r.jsx)(N.Z,{})}),(0,r.jsx)(G.Z,{onClick:()=>t(!0),children:(0,r.jsx)(R.Z,{})}),(0,r.jsx)(G.Z,{onClick:()=>l(!0),children:(0,r.jsx)(A.Z,{})})]})]}),(0,r.jsxs)(W.Z,{open:a,onClose:()=>l(!1),children:[(0,r.jsxs)(H.Z,{children:["Delete player ",n.playerName," from this campaign?"]}),(0,r.jsx)(L.Z,{children:(0,r.jsx)(B.Z,{children:"This action cannot be undone."})}),(0,r.jsxs)(V.Z,{children:[(0,r.jsx)(g.Z,{variant:"contained",onClick:()=>l(!1),children:"Cancel"}),(0,r.jsxs)(g.Z,{variant:"contained",onClick:()=>{o(),l(!1)},color:"error",children:[(0,r.jsx)(A.Z,{})," Delete"]})]})]})]})}function J(e){let{player:n,campaign:i,onCancelAdd:t}=e,[a,l]=(0,b.useState)(!1);return a||!n?(0,r.jsx)(D,{player:n,campaignId:i.id,setEditing:l,onCancelAdd:t}):(0,r.jsx)(U,{player:n,campaign:i,setEditing:l})}function X(e){let{campaign:n}=e,[i,t]=(0,b.useState)(!1),a=(0,b.useMemo)(()=>i?n.players.concat(void 0):n.players,[i,n.players]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(T.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[(0,r.jsx)(u.Z,{variant:"h4",children:"Players"}),(0,r.jsx)(u.Z,{variant:"h5",color:"text.secondary",children:"Inspiration Tracker"})]}),(0,r.jsx)(w.Z,{sx:{marginTop:2,paddingTop:0,border:0,borderTop:2,borderStyle:"solid",borderColor:"primary.light"},children:a.map(e=>(0,r.jsx)(M.ZP,{sx:{border:0,borderBottom:1,borderStyle:"solid",borderColor:"grey.400",marginTop:1,marginBottom:1},children:(0,r.jsx)(J,{player:e,campaign:n,onCancelAdd:()=>t(!1)})},(null==e?void 0:e.id)||"new-player"))}),!i&&(0,r.jsx)(T.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,r.jsxs)(g.Z,{variant:"contained",color:"success",onClick:()=>t(!0),children:[(0,r.jsx)(N.Z,{})," New Player"]})})]})}let $=f.Ry().shape({name:f.Z_().required("Campaign Name is required")});function K(e){let{campaign:n}=e,[i]=(0,C.u9)(),t=(0,c.Z)(),a=(0,d.Z)(t.breakpoints.only("xs")),l=(0,b.useMemo)(()=>{var e;return{name:n.name,gmInspiration:n.gmInspiration,cooldownType:n.cooldownType,cooldownTime:null===(e=n.cooldownTime)||void 0===e?void 0:e.toString()}},[n]),s=(0,b.useCallback)(async e=>{i({variables:{id:n.id,input:{name:e.name,gmInspiration:e.gmInspiration,cooldownType:e.cooldownType,cooldownTime:parseInt(e.cooldownTime,10)}}})},[n.id,i]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.Z,{variant:"h3",children:"Edit Campaign"}),(0,r.jsx)(o.J9,{initialValues:l,enableReinitialize:!0,validationSchema:$,onSubmit:s,children:e=>{let{handleReset:n,isValid:i,dirty:t}=e;return(0,r.jsx)(o.l0,{children:(0,r.jsxs)(x.ZP,{container:!0,spacing:2,my:2,children:[(0,r.jsx)(x.ZP,{item:!0,xs:12,sm:8,children:(0,r.jsx)(o.gN,{name:"name",children:e=>{let{field:n,meta:i}=e;return(0,r.jsx)(m.Z,{required:!0,id:"name",label:"Campaign Name",fullWidth:!0,error:i.touched&&!!i.error,helperText:i.error,...n})}})}),(0,r.jsx)(x.ZP,{item:!0,xs:12,sm:4,sx:{textAlign:"right",mt:1,order:a?"1":void 0},children:(0,r.jsx)(o.gN,{name:"gmInspiration",children:e=>{let{field:n,form:i}=e;return(0,r.jsx)(h.Z,{id:"gmInspiration",label:"GM Gets Inspiration",labelPlacement:"start",control:(0,r.jsx)(p.Z,{color:"primary",checked:n.value,onFocus:()=>i.setFieldTouched(n.name),...n})})}})}),(0,r.jsx)(x.ZP,{item:!0,xs:12,sm:6,children:(0,r.jsx)(o.gN,{name:"cooldownType",children:e=>{let{field:n}=e;return(0,r.jsxs)(j.Z,{fullWidth:!0,children:[(0,r.jsx)(v.Z,{id:"cooldownTypeLabel",children:"Cooldown Type"}),(0,r.jsxs)(y.Z,{labelId:"cooldownTypeLabel",id:"cooldownType",label:"Cooldown Type",...n,children:[(0,r.jsx)(Z.Z,{value:"none",children:"None"}),(0,r.jsx)(Z.Z,{value:"player",children:"Per-Player"}),(0,r.jsx)(Z.Z,{value:"table",children:"Entire Table"})]})]})}})}),(0,r.jsx)(x.ZP,{item:!0,xs:12,sm:6,children:(0,r.jsx)(o.gN,{name:"cooldownTime",children:e=>{let{field:n}=e;return(0,r.jsx)(m.Z,{id:"cooldownTime",label:"Cooldown Time (Minutes)",fullWidth:!0,inputProps:{inputMode:"numeric",pattern:"[0-9]*"},...n,onChange:e=>{e.target.value=(parseInt(e.target.value,10)||0).toString(),n.onChange(e)}})}})}),t&&(0,r.jsxs)(x.ZP,{item:!0,xs:12,sx:{textAlign:"right",order:"2"},children:[(0,r.jsx)(g.Z,{variant:"contained",color:"secondary",onClick:n,sx:{mr:2},children:"Reset"}),(0,r.jsx)(g.Z,{variant:"contained",color:"primary",disabled:!i,type:"submit",children:"Save"})]})]})})}}),(0,r.jsx)(X,{campaign:n})]})}function Q(){var e;let n=(0,s.useRouter)(),{campaignId:i}=n.query,{data:a}=(0,C.mU)({variables:{id:i}});return(null==a?void 0:a.campaign)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l(),{children:(0,r.jsx)("title",{children:"".concat(null!==(e=null==a?void 0:a.campaign.name)&&void 0!==e?e:"Campaign"," Details | OBS GM Overlay")})}),(0,r.jsx)(t.Z,{fixed:!0,children:(0,r.jsx)(K,{campaign:a.campaign})})]})}},4505:function(e,n,i){"use strict";i.d(n,{J_:function(){return s},sG:function(){return t},qI:function(){return m},y1:function(){return h}});var r=i(3595);function t(e){return e instanceof Date?e:(0,r.D)(e)}var a=i(2290),l=i(2090);function s(e,n){var i;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["hours","minutes","seconds"],t={xSeconds:"{{count}}",xMinutes:"{{count}}",xHours:"{{count}}"},s=(0,a.y)({start:e,end:n});return(0,l.L)(s,{format:r,locale:{formatDistance:(e,n)=>{var r;return null!==(i=null===(r=t[e])||void 0===r?void 0:r.replace("{{count}}",null==n?void 0:n.toString().padStart(2,"0")))&&void 0!==i?i:""}},delimiter:":",zero:!0}).replace(/^0(\d)/,"$1")}var o=i(7294),c=i(3337),d=i(3732),u=i(209);function x(e){let{player:n,campaign:i}=e;if(!n||!i||!i.gmInspiration&&n.isGM||"none"===i.cooldownType)return 0;let r=t("player"===i.cooldownType?n.lastInspirationUsed:i.lastInspirationUsed),a=(0,d.m)(r,i.cooldownTime),l=a>new Date,s=l?(0,u.c)(a,new Date):0;return s}function m(e){var n;let{player:i,campaign:r}=e,[t,a]=(0,o.useState)(x({player:i,campaign:r}));return(0,o.useEffect)(()=>{a(x({player:i,campaign:r}))},[i,r]),(0,c.Z)(()=>{a(x({player:i,campaign:r}))},r&&"none"===r.cooldownType?null:1e3),{cooldownTimeRemaining:t,percentComplete:Math.round(t/((null!==(n=null==r?void 0:r.cooldownTime)&&void 0!==n?n:0)*60)*100),formattedDuration:(0,l.L)({hours:Math.trunc(t/60/60),minutes:Math.trunc(t/60%60),seconds:Math.trunc(t%60)},{format:["hours","minutes","seconds"]})}}function h(e,n){let i=(0,o.useRef)();return(0,o.useCallback)(function(){for(var r=arguments.length,t=Array(r),a=0;a<r;a++)t[a]=arguments[a];let l=()=>{clearTimeout(i.current),e(...t)};clearTimeout(i.current),i.current=window.setTimeout(l,n)},[e,n])}}},function(e){e.O(0,[948,387,934,404,774,888,179],function(){return e(e.s=1147)}),_N_E=e.O()}]);