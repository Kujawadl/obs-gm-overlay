(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[847],{44689:(e,n,r)=>{"use strict";r.d(n,{A:()=>h});var t=r(37876),o=r(61428),i=r(2312),l=r(77328),a=r.n(l),d=r(54587),u=r.n(d),s=r(14232),c=r(67009),m=r(57982),p=r(74110);function h(e){var n;let{campaign:r,style:l="overlay",forceShowMonsterNames:d=!1}=e,{hideMonsterNames:h,round:v,turn:g,turnStart:x}=(0,s.useMemo)(()=>{var e;return null!=(e=null==r?void 0:r.activeEncounter)?e:{hideMonsterNames:m.F3.Always,round:0,turn:0,turnStart:null}},[r]),f=(0,s.useMemo)(()=>{var e,n;return null!=(n=null==r||null==(e=r.activeEncounter)?void 0:e.combatants.sort((e,n)=>e.turnOrder-n.turnOrder))?n:[]},[r]),[b,y]=(0,s.useState)(null),[w,j]=(0,s.useState)(!1);return(0,c.A)(()=>{if((v>0||g>0)&&x){let e=new Date,n=(0,p._U)(x);y((0,p.zA)((0,p._U)(x),e,["minutes","seconds"])),j(e.getTime()-n.getTime()>6e4)}else b&&(y(null),j(!1))},1e3),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a(),{children:(0,t.jsx)("title",{children:"".concat(null!=(n=null==r?void 0:r.name)?n:"Campaign"," Initiative | OBS GM Overlay")})}),(0,t.jsxs)(o.A,{variant:"h5",sx:"overlay"===l?{marginLeft:2,marginRight:2}:{paddingTop:2,paddingBottom:2,paddingLeft:4,paddingRight:4,border:0,borderStyle:"solid",borderTop:2,borderTopColor:"primary.light",borderBottom:1,borderBottomColor:"grey.400"},children:[v?"Round ".concat(v):"Combat Not Started",(0,t.jsx)(i.A,{className:w?"blink":void 0,sx:{color:w?"error.main":"text.secondary",display:"inline-flex"},children:b?"(".concat(b,")"):(0,t.jsx)(i.A,{sx:{display:"inline-block",width:62}})})]}),"overlay"===l&&(0,t.jsx)("hr",{style:{width:"100%",padding:0,border:"none",borderTop:"medium double #333",color:"#333"}}),f.map((e,n)=>(0,t.jsxs)(i.A,{sx:"overlay"===l?{display:"flex",flexDirection:"row",alignItems:"center",height:32}:{display:"flex",flexDirection:"row",alignItems:"center",height:32,marginTop:2,paddingBottom:2,border:0,borderBottom:1,borderStyle:"solid",borderColor:"grey.400"},children:[(0,t.jsx)(i.A,{sx:{width:32,display:"inline-block",marginBottom:"-6px"},children:e.turnOrder===g&&(0,t.jsx)(u(),{src:"/d20.png",alt:"d20",height:32,width:32})}),(0,t.jsx)(i.A,{sx:{fontWeight:e.turnOrder===g?"bold":void 0,textDecoration:e.turnOrder===g?"underline":void 0},children:d?e.name:function(){switch(h){case m.F3.Always:if(!e.public)return"???";break;case m.F3.UntilTurn:if(!e.public&&g<e.turnOrder&&v<=1)return"???";break;default:return e.name}}()})]},"combatant_".concat(n,"_").concat(e)))]})}},55481:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>s});var t=r(37876),o=r(2312),i=r(77328),l=r.n(i),a=r(89099),d=r(44689),u=r(57982);function s(){var e,n,r,i,s;let{campaignId:c}=(0,a.useRouter)().query,{data:m}=(0,u.N$)({variables:{id:c}});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l(),{children:(0,t.jsx)("title",{children:"".concat(null!=(s=null==m||null==(n=m.campaign)||null==(e=n.activeEncounter)?void 0:e.name)?s:"Encounter"," Initiative | OBS GM Overlay")})}),!!(null==m||null==(i=m.campaign)||null==(r=i.activeEncounter)?void 0:r.round)&&(0,t.jsx)(o.A,{sx:{display:"inline-flex",flexDirection:"column",width:"auto",justifyContent:"space-around",border:"80px solid transparent",borderImage:"url(/celtic-frame.png)",borderImageSlice:"320 fill"},children:(0,t.jsx)(d.A,{campaign:null==m?void 0:m.campaign})})]})}},58496:(e,n,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/[campaignId]/overlay/initiative",function(){return r(55481)}])},74110:(e,n,r)=>{"use strict";r.d(n,{zA:()=>a,_U:()=>o,$t:()=>p});var t=r(20622);function o(e){return e instanceof Date?e:e?(0,t.H)(e):void 0}var i=r(63253),l=r(21175);function a(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["hours","minutes","seconds"],t={xSeconds:"{{count}}",xMinutes:"{{count}}",xHours:"{{count}}"},o=(0,i.F)({start:e,end:n});return(0,l.a)(o,{format:r,locale:{formatDistance:(e,n)=>{var r,o;return null!=(o=null==(r=t[e])?void 0:r.replace("{{count}}",null==n?void 0:n.toString().padStart(2,"0")))?o:""}},delimiter:":",zero:!0}).replace(/^0(\d)/,"$1")}var d=r(14232),u=r(67009),s=r(12858),c=r(10887);function m(e){let{player:n,campaign:r}=e;if(!n||!r||!r.gmInspiration&&n.isGM||"none"===r.cooldownType)return 0;let t=o("player"===r.cooldownType?n.lastInspirationUsed:r.lastInspirationUsed),i=(0,s.z)(t,r.cooldownTime);return i>new Date?(0,c.O)(i,new Date):0}function p(e){var n;let{player:r,campaign:t}=e,[o,i]=(0,d.useState)(m({player:r,campaign:t}));return(0,d.useEffect)(()=>{i(m({player:r,campaign:t}))},[r,t]),(0,u.A)(()=>{i(m({player:r,campaign:t}))},t&&"none"===t.cooldownType?null:1e3),{cooldownTimeRemaining:o,percentComplete:Math.round(o/((null!=(n=null==t?void 0:t.cooldownTime)?n:0)*60)*100),formattedDuration:(0,l.a)({hours:Math.trunc(o/60/60),minutes:Math.trunc(o/60%60),seconds:Math.trunc(o%60)},{format:["hours","minutes","seconds"]})}}}},e=>{e.O(0,[231,587,636,593,792],()=>e(e.s=58496)),_N_E=e.O()}]);