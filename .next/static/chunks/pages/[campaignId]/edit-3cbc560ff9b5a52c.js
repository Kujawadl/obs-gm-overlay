(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[982],{60352:(e,n,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/[campaignId]/edit",function(){return i(89900)}])},74110:(e,n,i)=>{"use strict";i.d(n,{zA:()=>t,_U:()=>a,$t:()=>m});var r=i(20622);function a(e){return e instanceof Date?e:e?(0,r.H)(e):void 0}var l=i(63253),s=i(21175);function t(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["hours","minutes","seconds"],r={xSeconds:"{{count}}",xMinutes:"{{count}}",xHours:"{{count}}"},a=(0,l.F)({start:e,end:n});return(0,s.a)(a,{format:i,locale:{formatDistance:(e,n)=>{var i,a;return null!=(a=null==(i=r[e])?void 0:i.replace("{{count}}",null==n?void 0:n.toString().padStart(2,"0")))?a:""}},delimiter:":",zero:!0}).replace(/^0(\d)/,"$1")}var o=i(14232),d=i(67009),c=i(12858),x=i(10887);function u(e){let{player:n,campaign:i}=e;if(!n||!i||!i.gmInspiration&&n.isGM||"none"===i.cooldownType)return 0;let r=a("player"===i.cooldownType?n.lastInspirationUsed:i.lastInspirationUsed),l=(0,c.z)(r,i.cooldownTime);return l>new Date?(0,x.O)(l,new Date):0}function m(e){var n;let{player:i,campaign:r}=e,[a,l]=(0,o.useState)(u({player:i,campaign:r}));return(0,o.useEffect)(()=>{l(u({player:i,campaign:r}))},[i,r]),(0,d.A)(()=>{l(u({player:i,campaign:r}))},r&&"none"===r.cooldownType?null:1e3),{cooldownTimeRemaining:a,percentComplete:Math.round(a/((null!=(n=null==r?void 0:r.cooldownTime)?n:0)*60)*100),formattedDuration:(0,s.a)({hours:Math.trunc(a/60/60),minutes:Math.trunc(a/60%60),seconds:Math.trunc(a%60)},{format:["hours","minutes","seconds"]})}}},89900:(e,n,i)=>{"use strict";i.r(n),i.d(n,{default:()=>Q});var r=i(37876),a=i(87460),l=i(77328),s=i.n(l),t=i(89099),o=i(39593),d=i(60964),c=i(11863),x=i(61428),u=i(12809),m=i(33354),h=i(93890),p=i(77720),j=i(65621),A=i(98895),v=i(72080),y=i(4146),g=i(32643),b=i(14232),f=i(91408),C=i(57982),M=i(2312),w=i(40510),T=i(83694),N=i(92989),k=i(65965),I=i(71257);let z=(0,I.A)((0,r.jsx)("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2M4 12c0-4.4 3.6-8 8-8 1.8 0 3.5.6 4.9 1.7L5.7 16.9C4.6 15.5 4 13.8 4 12m8 8c-1.8 0-3.5-.6-4.9-1.7L18.3 7.1C19.4 8.5 20 10.2 20 12c0 4.4-3.6 8-8 8"}),"DoNotDisturbAlt"),S=(0,I.A)((0,r.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");var G=i(94527);function D(e){let{icon:n,text:i,...a}=e,l=(0,d.A)();return(0,c.A)(l.breakpoints.only("xs"))?(0,r.jsx)(G.A,{...a,children:n}):(0,r.jsx)(g.A,{...a,children:i})}let P=f.Ik().shape({playerName:f.Yj().required("Player Name is required")});function _(e){let{player:n,campaignId:i,setEditing:a,onCancelAdd:l}=e,[s,{loading:t}]=(0,C.R1)(),d=(0,b.useMemo)(()=>({playerName:(null==n?void 0:n.playerName)||"",characterName:(null==n?void 0:n.characterName)||"",isGM:(null==n?void 0:n.isGM)||!1}),[null==n?void 0:n.playerName,null==n?void 0:n.characterName,null==n?void 0:n.isGM]),c=(0,b.useCallback)(async e=>{s({variables:{id:null==n?void 0:n.id,input:{campaignId:i,...e}}}).then(()=>{n||l(),a(!1)})},[n,i,s,l,a]);return(0,r.jsx)(o.l1,{initialValues:d,onSubmit:c,validationSchema:P,children:e=>{let{values:i,isValid:s}=e;return(0,r.jsx)(o.lV,{style:{flexBasis:"100%"},children:(0,r.jsxs)(u.A,{container:!0,spacing:2,alignItems:"center",mr:-2,children:[(0,r.jsx)(u.A,{size:{xs:8,md:3},children:(0,r.jsx)(o.D0,{name:"playerName",children:e=>{let{field:n,meta:i}=e;return(0,r.jsx)(m.A,{required:!0,id:"playerName",label:"Player Name",fullWidth:!0,autoFocus:!0,error:i.touched&&!!i.error,helperText:i.touched?i.error:void 0,...n})}})}),(0,r.jsx)(u.A,{size:{xs:4,md:3},sx:{display:"flex",justifyContent:"center"},children:(0,r.jsx)(o.D0,{name:"isGM",children:e=>{let{field:n}=e;return(0,r.jsx)(h.A,{id:"isGM",label:"GM",labelPlacement:"start",control:(0,r.jsx)(p.A,{color:"primary",checked:n.value,...n})})}})}),(0,r.jsx)(u.A,{size:{xs:8,md:3},children:(0,r.jsx)(o.D0,{name:"characterName",children:e=>{let{field:n}=e;return(0,r.jsx)(m.A,{id:"characterName",label:"Character Name",disabled:i.isGM,sx:{visibility:i.isGM?"hidden":void 0},fullWidth:!0,...n})}})}),(0,r.jsxs)(u.A,{size:{xs:4,md:3},sx:{display:"flex",justifyContent:"flex-end"},children:[(0,r.jsx)(D,{variant:"contained",color:"secondary",sx:{mr:1},onClick:()=>{n||l(),a(!1)},icon:(0,r.jsx)(z,{}),text:"Cancel"}),t?(0,r.jsx)(k.A,{}):(0,r.jsx)(D,{type:"submit",variant:"contained",color:"primary",disabled:!s||t,icon:(0,r.jsx)(S,{}),text:"Save"})]})]})})}})}let E=(0,I.A)((0,r.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"Restore"),F=(0,I.A)((0,r.jsx)("path",{d:"M19 13H5v-2h14z"}),"Remove");var q=i(25878),H=i(92781),W=i(36448),R=i(65657),V=i(97444),L=i(34293),O=i(59256),B=i(72528),$=i(74110);function U(e){let{player:n,campaign:i,setEditing:a}=e,[l,s]=(0,b.useState)(!1),[t]=(0,C.aY)(),[o]=(0,C.HP)({variables:{id:n.id}}),[x]=(0,C.qi)({variables:{id:n.id}}),h=(0,d.A)(),p=(0,c.A)(h.breakpoints.only("xs")),{cooldownTimeRemaining:j,percentComplete:A,formattedDuration:v}=(0,$.$t)({player:n,campaign:i}),y=(0,b.useCallback)(e=>{t({variables:{id:n.id,inspiration:e.target.value?Math.max(parseInt(e.target.value,10),0):0}})},[n.id,t]),f=(0,b.useCallback)(()=>{t({variables:{id:n.id,inspiration:n.inspiration+1}})},[n.id,n.inspiration,t]),w=(0,b.useCallback)(()=>{t({variables:{id:n.id,inspiration:Math.max(n.inspiration-1,0)}})},[n.id,n.inspiration,t]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.A,{container:!0,alignItems:"center",children:[(0,r.jsxs)(u.A,{size:{xs:8},children:[(0,r.jsx)(M.A,{component:"span",sx:{fontWeight:"bold",paddingRight:1},children:n.playerName}),!p&&(n.characterName||n.isGM)&&(0,r.jsxs)(M.A,{component:"span",sx:{color:"text.secondary"},children:["(",n.isGM?"GM":n.characterName,")"]})]}),(0,r.jsxs)(u.A,{size:{xs:4},sx:{display:"flex",justifyContent:"flex-end"},children:[j>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(G.A,{onClick:()=>x(),children:(0,r.jsx)(E,{})}),(0,r.jsx)(W.A,{title:"".concat(v," remaining on cooldown"),children:(0,r.jsx)(k.A,{variant:"determinate",size:"1.5rem",sx:{alignSelf:"center",textAlign:"center",margin:"calc(calc(40px - 1.5rem) / 2)",flex:"0 0 auto"},value:A})})]}):(0,r.jsx)(G.A,{onClick:w,sx:{visibility:i.gmInspiration||!n.isGM?"visible":"hidden"},children:(0,r.jsx)(F,{})}),(0,r.jsx)(m.A,{inputProps:{inputMode:"numeric",pattern:"[0-9]*",style:{textAlign:"center"}},size:"small",sx:{minWidth:50,maxWidth:50,visibility:i.gmInspiration||!n.isGM?"visible":"hidden"},value:n.inspiration,onChange:y}),(0,r.jsx)(G.A,{onClick:f,sx:{visibility:i.gmInspiration||!n.isGM?"visible":"hidden"},children:(0,r.jsx)(N.A,{})}),(0,r.jsx)(G.A,{onClick:()=>a(!0),children:(0,r.jsx)(q.A,{})}),(0,r.jsx)(G.A,{onClick:()=>s(!0),children:(0,r.jsx)(H.A,{})})]})]}),(0,r.jsxs)(R.A,{open:l,onClose:()=>s(!1),children:[(0,r.jsxs)(V.A,{children:["Delete player ",n.playerName," from this campaign?"]}),(0,r.jsx)(L.A,{children:(0,r.jsx)(O.A,{children:"This action cannot be undone."})}),(0,r.jsxs)(B.A,{children:[(0,r.jsx)(g.A,{variant:"contained",onClick:()=>s(!1),children:"Cancel"}),(0,r.jsxs)(g.A,{variant:"contained",onClick:()=>{o(),s(!1)},color:"error",children:[(0,r.jsx)(H.A,{})," Delete"]})]})]})]})}function Y(e){let{player:n,campaign:i,onCancelAdd:a}=e,[l,s]=(0,b.useState)(!1);return l||!n?(0,r.jsx)(_,{player:n,campaignId:i.id,setEditing:s,onCancelAdd:a}):(0,r.jsx)(U,{player:n,campaign:i,setEditing:s})}function X(e){let{campaign:n}=e,[i,a]=(0,b.useState)(!1),l=(0,b.useMemo)(()=>i?n.players.concat(void 0):n.players,[i,n.players]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(M.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[(0,r.jsx)(x.A,{variant:"h4",children:"Players"}),(0,r.jsx)(x.A,{variant:"h5",color:"text.secondary",children:"Inspiration Tracker"})]}),(0,r.jsx)(w.A,{sx:{marginTop:2,paddingTop:0,border:0,borderTop:2,borderStyle:"solid",borderColor:"primary.light"},children:l.map(e=>(0,r.jsx)(T.Ay,{sx:{border:0,borderBottom:1,borderStyle:"solid",borderColor:"grey.400",marginTop:1,marginBottom:1},children:(0,r.jsx)(Y,{player:e,campaign:n,onCancelAdd:()=>a(!1)})},(null==e?void 0:e.id)||"new-player"))}),!i&&(0,r.jsx)(M.A,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,r.jsxs)(g.A,{variant:"contained",color:"success",onClick:()=>a(!0),children:[(0,r.jsx)(N.A,{})," New Player"]})})]})}let J=f.Ik().shape({name:f.Yj().required("Campaign Name is required")});function K(e){let{campaign:n}=e,[i]=(0,C.sF)(),a=(0,d.A)(),l=(0,c.A)(a.breakpoints.only("xs")),s=(0,b.useMemo)(()=>{var e;return{name:n.name,gmInspiration:n.gmInspiration,cooldownType:n.cooldownType,cooldownTime:null==(e=n.cooldownTime)?void 0:e.toString()}},[n]),t=(0,b.useCallback)(async e=>{i({variables:{id:n.id,input:{name:e.name,gmInspiration:e.gmInspiration,cooldownType:e.cooldownType,cooldownTime:parseInt(e.cooldownTime,10)}}})},[n.id,i]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.A,{variant:"h3",children:"Edit Campaign"}),(0,r.jsx)(o.l1,{initialValues:s,enableReinitialize:!0,validationSchema:J,onSubmit:t,children:e=>{let{handleReset:n,isValid:i,dirty:a}=e;return(0,r.jsx)(o.lV,{children:(0,r.jsxs)(u.A,{container:!0,spacing:2,my:2,children:[(0,r.jsx)(u.A,{size:{xs:12,sm:8},children:(0,r.jsx)(o.D0,{name:"name",children:e=>{let{field:n,meta:i}=e;return(0,r.jsx)(m.A,{required:!0,id:"name",label:"Campaign Name",fullWidth:!0,error:i.touched&&!!i.error,helperText:i.error,...n})}})}),(0,r.jsx)(u.A,{size:{xs:12,sm:4},sx:{textAlign:"right",mt:1,order:l?"1":void 0},children:(0,r.jsx)(o.D0,{name:"gmInspiration",children:e=>{let{field:n,form:i}=e;return(0,r.jsx)(h.A,{id:"gmInspiration",label:"GM Gets Inspiration",labelPlacement:"start",control:(0,r.jsx)(p.A,{color:"primary",checked:n.value,onFocus:()=>i.setFieldTouched(n.name),...n})})}})}),(0,r.jsx)(u.A,{size:{xs:12,sm:6},children:(0,r.jsx)(o.D0,{name:"cooldownType",children:e=>{let{field:n}=e;return(0,r.jsxs)(j.A,{fullWidth:!0,children:[(0,r.jsx)(A.A,{id:"cooldownTypeLabel",children:"Cooldown Type"}),(0,r.jsxs)(v.A,{labelId:"cooldownTypeLabel",id:"cooldownType",label:"Cooldown Type",...n,children:[(0,r.jsx)(y.A,{value:"none",children:"None"}),(0,r.jsx)(y.A,{value:"player",children:"Per-Player"}),(0,r.jsx)(y.A,{value:"table",children:"Entire Table"})]})]})}})}),(0,r.jsx)(u.A,{size:{xs:12,sm:6},children:(0,r.jsx)(o.D0,{name:"cooldownTime",children:e=>{let{field:n}=e;return(0,r.jsx)(m.A,{id:"cooldownTime",label:"Cooldown Time (Minutes)",fullWidth:!0,inputProps:{inputMode:"numeric",pattern:"[0-9]*"},...n,onChange:e=>{e.target.value=(parseInt(e.target.value,10)||0).toString(),n.onChange(e)}})}})}),a&&(0,r.jsxs)(u.A,{size:{xs:12},sx:{textAlign:"right",order:"2"},children:[(0,r.jsx)(g.A,{variant:"contained",color:"secondary",onClick:n,sx:{mr:2},children:"Reset"}),(0,r.jsx)(g.A,{variant:"contained",color:"primary",disabled:!i,type:"submit",children:"Save"})]})]})})}}),(0,r.jsx)(X,{campaign:n})]})}function Q(){var e;let{campaignId:n}=(0,t.useRouter)().query,{data:i}=(0,C.N$)({variables:{id:n}});return(null==i?void 0:i.campaign)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s(),{children:(0,r.jsx)("title",{children:"".concat(null!=(e=null==i?void 0:i.campaign.name)?e:"Campaign"," Details | OBS GM Overlay")})}),(0,r.jsx)(a.A,{fixed:!0,children:(0,r.jsx)(K,{campaign:i.campaign})})]})}}},e=>{e.O(0,[46,798,231,632,99,930,636,593,792],()=>e(e.s=60352)),_N_E=e.O()}]);